"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[452],{5353:function(e,l,s){var i=s(5893),r=s(7294),a=s(5775),n=s(6264),t=s(7953),o=s(9655);let d={otp:0};l.Z=e=>{let{user:l,authType:s,handleSuccess:c,token:u,storeId:m}=e,[p,h]=(0,r.useState)([{label:"OTP",fieldname:"otp",placeholder:"****",value:"",id:5,keyboardType:"password",isPassword:!0,isPasswordVisible:!1,error:null,isRequired:!0,emptyErrorMessage:"OTP is required. Please provide the OTP.",inputWidthSize:"12"}]),[b,f]=(0,r.useState)(!1),[g,v]=(0,r.useState)(!1),[x,y]=(0,r.useState)(30),[P,N]=(0,r.useState)(null),[q,w]=(0,r.useState)(2),[j,E]=(0,r.useState)(null),[O,k]=(0,r.useState)(!1),{apiPost:I}=(0,o.kL)(),S=(e,l)=>{let s=[...p];s[l].value=e,s[l].error=null,h(s)},L=e=>{let l=[...p],s=p[e].isPasswordVisible;l[e].keyboardType=s?"password":"default",l[e].isPasswordVisible=!s,h(l)},T=e=>!!e&&/^\d+$/.test(e),R=async()=>{let e=p[d.otp].value.trim();if(T(e)&&4===e.length){var i,r,a,n;let o;E(null),k(!0);let d="".concat(t.kh.qfferAPI,"/customer/web/signUp/email/").concat(m,"?otp=").concat(e),p=JSON.stringify(l);"PROFILE"===s?(d="".concat(t.kh.qfferAPI,"/customer/web/email/verify/").concat(e),p=JSON.stringify({value:null})):"LOGIN"===s&&(d="".concat(t.kh.qubriuxAPI,"/store/").concat(m,"/customer/login/verifyOTPAndLogin?otp=").concat(e),p=JSON.stringify({email:l.email?l.email:null,phoneNumber:l.phone?l.phone:null,storeId:m}));try{o="PROFILE"===s?await I(d,p,null,u):await I(d,p)}catch(e){E("Something went wrong! Please try again after some time."),k(!1)}(null===(r=o)||void 0===r?void 0:null===(i=r.message)||void 0===i?void 0:i.toLowerCase())==="success"?(console.log("response: ",o),c(o.body)):(null===(n=o)||void 0===n?void 0:null===(a=n.message)||void 0===a?void 0:a.toLowerCase())==="failure"&&o.body?E(o.body):E("Something went wrong! Please try again after some time."),k(!1)}else{let e=[...p];e[d.otp].error="Invalid OTP format. Please enter a valid OTP.",h(e)}},A=async()=>{let e;E(null);let i="".concat(t.kh.qfferAPI,"/customer/web/create/phone/verify"),r=JSON.stringify({value:l.phone});"PROFILE"===s?(i="".concat(t.kh.qfferAPI,"/customer/web/email/verify"),r=JSON.stringify({value:null})):"LOGIN"===s&&(i="".concat(t.kh.qubriuxAPI,"/store/").concat(m,"/customer/login/sendOTP"),r=JSON.stringify({email:l.email?l.email:null,phoneNumber:l.phone?l.phone:null,storeId:m}));try{e="PROFILE"===s?await I(i,r,null,u):await I(i,r)}catch(e){}console.log("response: ",e)},C=()=>{let e;try{e=setInterval(()=>{y(e=>e-1)},1e3),N(e),v(!1)}catch(l){clearInterval(e)}},M=()=>{let e=!0;return p.forEach(l=>{l.isRequired&&!l.value&&(e=!1)}),!e},D=(0,r.useMemo)(()=>M(),[p]);return(0,r.useEffect)(()=>{g&&C()},[g]),(0,r.useEffect)(()=>{1===x&&P?(clearInterval(P),f(!0)):30===x&&(v(!0),f(!1))},[x]),(0,i.jsxs)("form",{className:"qb-signup-form px-md-5 py-5 d-flex flex-column align-items-stretch",id:"qb-signupform",onSubmit:e=>{e.preventDefault()},children:[(0,i.jsx)("h3",{className:"qb-title mb-0 pb-2 qb-signup-title-text",children:"Verify Profile"}),(0,i.jsxs)("p",{className:"qb-description mb-0 pb-4",children:["Please enter the 4 digit OTP","PROFILE"===s?" sent to your email address":"".concat(l.phone?"  sent to ".concat(l.phone):""),"."]}),(0,i.jsx)("div",{className:"container-fluid px-0 pt-md-0",children:(0,i.jsxs)("div",{className:"row gy-3",children:[p.map((e,l)=>(0,i.jsx)("div",{className:"col-12 col-lg-".concat(e.inputWidthSize),children:(0,i.jsx)(a.Wz,{value:e.value,id:e.id,index:l,label:e.label,placeholder:e.placeholder,fieldname:e.fieldname,error:e.error,isRequired:e.isRequired,fieldType:e.keyboardType,isPassword:e.isPassword,showPassword:e.isPasswordVisible,isDisabled:e.isDisabled,onViewPassword:L,onChange:S})},"input-".concat(l))),(0,i.jsx)("div",{className:"col-12",children:(0,i.jsxs)("div",{className:"d-flex align-items-center qb-resend-wrap",children:[(0,i.jsx)("p",{className:"qb-tag pe-2 mb-0",children:"Didn’t receive OTP?"}),(0,i.jsxs)("a",{className:b&&q?"qb-link qb-resend-otp-link d-flex align-items-center":"qb-link qb-resend-otp-link d-flex align-items-center qb-link-disabled",onClick:()=>{b&&q>0?(y(30),w(e=>e-1),A()):0===q&&E("You've reached the maximum OTP resend attempts. Please try again later.")},children:["Resend OTP ",(0,i.jsx)("span",{className:"qb-counter-wrap ps-1",children:b?" (".concat(q," ").concat(1===q?"try":"tries"," remaining)"):" (".concat(x,"s)")})]})]})}),(null==j?void 0:j.length)?(0,i.jsx)("div",{className:"col-12",children:(0,i.jsx)("p",{className:"qb-input-error-message mt-1 qb-general-error qb-error-active",children:j})}):null,(0,i.jsx)("div",{className:"col-lg-12",children:(0,i.jsx)("div",{className:"w-100 pt-md-3 pt-3 d-flex flex-column flex-md-row align-items-stretch align-items-md-center justify-content-end",children:(0,i.jsx)(n.K,{id:"qb-profile-btn",isDisabled:D,isLoading:O,onDisabledClick:()=>{let e=[...p];p.forEach((l,s)=>{l.isRequired&&!l.value&&(e[s].error=l.emptyErrorMessage?l.emptyErrorMessage:"Required field. Please fill this field to continue.")}),h([...e])},onClick:R,children:(0,i.jsxs)(i.Fragment,{children:["Verify",(0,i.jsx)("span",{className:"qb-btn-loader ms-2"})]})})})})]})})]})}},6316:function(e,l,s){var i=s(5893),r=s(7294),a=s(5775),n=s(6264),t=s(7953),o=s(9655),d=s(1664),c=s.n(d);let u={user:0};l.Z=e=>{let{storeId:l,handleSuccess:s,signupUrl:d,loginUrl:m}=e,[p,h]=(0,r.useState)([{label:"Email/ Phone number",fieldname:"email",placeholder:"Email or phone number",value:"",id:2,keyboardType:"default",error:null,isRequired:!0,emptyErrorMessage:"Email or phone number is required. Please provide your email address or phone number.",inputWidthSize:"12"}]),[b,f]=(0,r.useState)(null),[g,v]=(0,r.useState)(!1),{apiPost:x}=(0,o.kL)(),{emailValidation:y,phoneValidation:P,returnErrorTexts:N}=(0,o.V$)(),q=(e,l)=>{let s=[...p];s[l].value=e,s[l].error=null,h(s)},w=e=>!!e&&/^\d+$/.test(e),j=async e=>{let l=e.slice(0,1),s=e;if("+"===l&&(s=e.slice(1)),w(s)){let e=s.slice(0,1),l=s.slice(1);return(1!=e&&(e=s.slice(0,2),l=s.slice(2)),await P(l))?{type:"PHONE",userId:s,userError:!1}:{type:"PHONE",userId:s,userError:!0}}return await y(s)?{type:"EMAIL",userId:s,userError:!1}:{type:"EMAIL",userId:s,userError:!0}},E=async()=>{console.log("IN");let{type:e,userId:i,userError:r}=await j(p[u.user].value);if(!r&&l){var a,n,o,d;let r;f(null),v(!0);let c="".concat(t.kh.qubriuxAPI,"/store/").concat(l,"/customer/login/sendOTP"),u=JSON.stringify({email:"EMAIL"===e?i:null,phoneNumber:"PHONE"===e?i:null,storeId:l});try{r=await x(c,u)}catch(e){f("Something went wrong! Please try again after some time."),v(!1)}(null===(a=r)||void 0===a?void 0:a.message)&&(null===(n=r)||void 0===n?void 0:n.message.toLowerCase())==="success"?(console.log("response: ",r.body),s({email:"EMAIL"===e?i:null,phone:"PHONE"===e?i:null})):((null===(o=r)||void 0===o?void 0:o.message)&&(null===(d=r)||void 0===d?void 0:d.message.toLowerCase())==="failure"&&r.body?f(r.body):f("Something went wrong! Please try again after some time."),v(!1))}else{let s=[...p];"EMAIL"===e?s[u.user].error=await N(i,"email"):"PHONE"===e&&(s[u.user].error="Invalid number format. Please enter a valid phone number."),l||f("This link seems to be expired or broken, Please try again with another link."),h(s)}},O=()=>{let e=!0;return p.forEach(l=>{l.isRequired&&!l.value&&(e=!1)}),!e},k=(0,r.useMemo)(()=>O(),[p]);return(0,i.jsxs)("form",{className:"qb-signup-form px-md-5 py-5 d-flex flex-column align-items-stretch",id:"qb-signupform",children:[(0,i.jsx)("h3",{className:"qb-title mb-0 pb-2 qb-signup-title-text",children:"Login with OTP"}),(0,i.jsx)("p",{className:"qb-desc mb-0 pb-4",children:"Enter your registered email id or phone number with country code to login using OTP."}),(0,i.jsx)("div",{className:"container-fluid px-0 pt-md-0",children:(0,i.jsxs)("div",{className:"row gy-3",children:[p.map((e,l)=>e.isInputHidden?null:(0,i.jsx)("div",{className:"col-12 col-lg-".concat(e.inputWidthSize),children:(0,i.jsx)(a.Wz,{value:e.value,id:e.id,index:l,label:e.label,placeholder:e.placeholder,fieldname:e.fieldname,error:e.error,isRequired:e.isRequired,fieldType:e.keyboardType,isDisabled:e.isDisabled,onChange:q})},"input-".concat(l))),(null==b?void 0:b.length)?(0,i.jsx)("div",{className:"col-12",children:(0,i.jsx)("p",{className:"qb-input-error-message mt-1 qb-general-error qb-error-active",children:b})}):null,(0,i.jsx)("div",{className:"col-lg-12",children:(0,i.jsxs)("div",{className:"w-100 pt-md-3 pt-3 d-flex align-items-center justify-content-end",children:[(0,i.jsx)("div",{className:"pe-4 d-flex align-items-center",children:(0,i.jsx)(c(),{href:m,className:"qb-link",children:"Login using password"})}),(0,i.jsx)("div",{className:"d-flex",children:(0,i.jsx)(n.K,{id:"qb-profile-btn",isDisabled:k,isLoading:g,onDisabledClick:()=>{let e=[...p];p.forEach((l,s)=>{l.isRequired&&!l.value&&(e[s].error=l.emptyErrorMessage?l.emptyErrorMessage:"Required field. Please fill this field to continue.")}),h([...e])},onClick:E,children:(0,i.jsxs)(i.Fragment,{children:["Get OTP",(0,i.jsx)("span",{className:"qb-btn-loader ms-2"})]})})})]})}),(0,i.jsx)("div",{className:"col-12",children:(0,i.jsx)("div",{className:"w-100 flex-column align-items-center align-items-md-end d-flex",children:d?(0,i.jsxs)("p",{className:"qb-description",children:["Don’t have an account? ",(0,i.jsx)(c(),{href:d,className:"qb-link",children:"Signup"})]}):null})})]})})]})}}}]);